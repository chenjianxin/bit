// @flow
import fs from 'fs-extra';
import { AbstractVinyl } from '../consumer/component/sources';
import { AUTO_GENERATED_STAMP, AUTO_GENERATED_MSG } from '../constants';

export default class LinkFile extends AbstractVinyl {
  override: ?boolean = true;
  writeAutoGeneratedMessage: ?boolean = true;

  async write(): Promise<string> {
    if (!this.override && fs.existsSync(this.path)) {
      const fileContent = fs.readFileSync(this.path).toString();
      if (!fileContent.includes(AUTO_GENERATED_STAMP)) return Promise.resolve(this.path);
    }

    const data = this.writeAutoGeneratedMessage ? AUTO_GENERATED_MSG + this.contents : this.contents;
    await fs.outputFile(this.path, data);
    return Promise.resolve(this.path);
  }
}
